filter(year == 2012) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = map(data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
group_by(year, month) %>%
nest()
monthly_fishing_pacific %>%
filter(year == 2012) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = map(.$data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, raster))
colnames(monthly_fishing_pacific)
monthly_fishing_pacific %>%
filter(year == 2012) %>%
select(year, month, x = lon, y = lat, hours) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>% colnames()
library(tidyverse)
monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, hours) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, hours) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, raster))
monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, raster))
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest()
a$data[[1]]
a$data[[1]] %>% ggplot(aes(x = x, y = y, fill = z)) + geom_raster()
a$data[[12]] %>% ggplot(aes(x = x, y = y, fill = z)) + geom_raster()
a$data[[12]] %>% raster()
a$data[[12]] %>% complete(x, y, fill = list(z = NA)) %>%  raster()
a$data[[12]] %>% complete(x, y, fill = list(z = NA)) %>% ggplot(aes(x = x, y = y, fill = z)) + geom_raster()
2+2
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = rasterize, fun = mean))
a$data[[12]] %>% rasterize()
a$data[[12]] %>% as.matrix() %>% rasterize()
?rasterize
my_rasterize <- function(data){
rasterize(data[,1], data[,2], data[,3])
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = rasterize, fun = mean))
my_rasterize <- function(data, ...){
rasterize(data[,1], data[,2], data[,3])
}
rasterize(data[,1], data[,2], data[,3], ...)
my_rasterize <- function(data, ...){
rasterize(data[,1], data[,2], data[,3], ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
my_rasterize <- function(data, ...){
data <- as.matrix(data)
rasterize(data[,1], data[,2], data[,3], ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
my_rasterize <- function(data, ...){
data <- as.matrix(data)
rasterize(x = data[,c(1:2)], field = data[,3], ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
extent(data[,1 c(1:2)])
a$data[[12]] -> data
extent(data[,1 c(1:2)])
extent(data[1, c(1:2)])
extent(data[c(1:2)])
?extent
extent(monthly_fishing_pacific[,c(1,2)])
extent(monthly_fishing_pacific[,c(3:4)])
colnames(monthly_fishing_pacific)
extent(monthly_fishing_pacific[,c(3, 4)])
monthly_fishing_pacific[,c(3, 4)]
extent(monthly_fishing_pacific[,c(4, 3)])
rangeextent(monthly_fishing_pacific[,c(4, 3)])
range(monthly_fishing_pacific[,c(4, 3)])
range(monthly_fishing_pacific[,c(4)])
range(monthly_fishing_pacific[,c(3)])
e <- extent(c(-180, 180, -90, 90))
360 / 0.1
my_rasterize <- function(data, ...){
data <- as.matrix(data)
e <- extent(c(-180, 180, -90, 90))
r <- raster(e, ncol = 3600, nrow = 1800)
rasterize(x = data[, c(1:2)], y = r, field = data[, 3], ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
a <- monthly_fishing_pacific %>%
filter(year == 2012,
month == 12) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
a$r %>% plot()
plot(a$r)
plot(a$r[[1]])
a <- monthly_fishing_pacific %>%
filter(year == 2012,
month < 4) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
r=stack(a$r)
class(r)
plot(r)
my_rasterize <- function(data, ...){
data <- as.matrix(data)
e <- extent(c(-180, 180, -90, 90))
r <- raster(e, ncol = 3600, nrow = 1800)
hours <- (data[, 3] / max(data[, 3])) * 100
rasterize(x = data[, c(1:2)], y = r, field = , ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012,
month < 4) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
plot(r)
my_rasterize <- function(data, ...){
data <- as.matrix(data)
e <- extent(c(-180, 180, -90, 90))
r <- raster(e, ncol = 3600, nrow = 1800)
hours <- (data[, 3] / sum(data[, 3])) * 100
rasterize(x = data[, c(1:2)], y = r, field = , ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012,
month < 4) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
plot(r)
r=stack(a$r)
plot(r)
my_rasterize <- function(data, ...){
data <- as.matrix(data)
e <- extent(c(-180, 180, -90, 90))
r <- raster(e, ncol = 3600, nrow = 1800)
hours <- (data[, 3] / sum(data[, 3])) * 100
rasterize(x = data[, c(1:2)], y = r, field = hours, ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012,
month < 4) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
plot(r)
r=stack(a$r)
plot(r)
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
r=stack(a$r)
plot(r)
calc(r, log, na.rm = T) %>% plot()
calc(r, log) %>% plot()
animate(r, n = 1)
my_rasterize <- function(data, ...){
data <- as.matrix(data)
e <- extent(c(-180, 180, -90, 90))
r <- raster(e, ncol = 3600, nrow = 1800)
hours <- log10((data[, 3] / sum(data[, 3])) * 100)
rasterize(x = data[, c(1:2)], y = r, field = hours, ...)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize, fun = mean))
r <- stack(a$r)
animate(r, n = 1)
my_rasterize <- function(data, ...){
data <- as.matrix(data)
e <- extent(c(-180, 180, -90, 90))
r <- raster(e, ncol = 360, nrow = 180)
hours <- (data[, 3] / sum(data[, 3])) * 100
rasterize(x = data[, c(1:2)], y = r, field = hours, fun = sum)
}
a <- monthly_fishing_pacific %>%
filter(year == 2012) %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize))
r <- stack(a$r)
animate(r, n = 1)
a <- monthly_fishing_pacific %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize))
r <- stack(a$r)
animate(r, n = 1)
monthly_fishing_pacific <- get_table(project = "ucsb-gfw",
dataset = "jc_bycatch",
table = "monthly_fishing_pacific")
write.csv(x = monthly_fishing_pacific,
file = here::here("final_project", "monthly_fishing_pacific.csv"),
row.names = F)
r <- monthly_fishing_pacific %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize)) %>%
select(r) %>%
unnest() %>%
stack()
r <- monthly_fishing_pacific %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize)) %>%
dplyr::select(r) %>%
unnest() %>%
stack()
r <- monthly_fishing_pacific %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize)) %>%
dplyr::select(r) %>%
unnest()
r <- monthly_fishing_pacific %>%
dplyr::select(year, month, x = lon, y = lat, z = hours) %>%
mutate(x = round(x, 2),
y = round(y, 2)) %>%
group_by(year, month) %>%
nest() %>%
mutate(r = purrr::map(.x = data, .f = my_rasterize))
a <- r
r <- stack(a$r)
animate(r, n = 1)
nino <- read.csv("all_indices", stringsAsFactors = F) %>%
dplyr::select(year, month = month_n, nino34anom)
nino <- read.csv(here("final_project", "all_indices"), stringsAsFactors = F) %>%
dplyr::select(year, month = month_n, nino34anom)
nino <- read.csv(here("final_project", "all_indices"), stringsAsFactors = F) %>%
dplyr::select(year, month = month_n, nino34anom)
library(here)
nino <- read.csv(here("final_project", "all_indices"), stringsAsFactors = F) %>%
dplyr::select(year, month = month_n, nino34anom)
here()
nino <- read.csv(here("final_project", "all_indices.csv"), stringsAsFactors = F) %>%
dplyr::select(year, month = month_n, nino34anom)
nino
monthly_fishing_pacific %>%
left_join(nino, by = c("year", "month"))
monthly_fishing_pacific %>%
left_join(nino, by = c("year", "month")) %>%
mutate(nino = nino34anom > 0) %>%
group_by(nino, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~nino)
monthly_fishing_pacific %>%
left_join(nino, by = c("year", "month")) %>%
drop_na(nino34anom) %>%
mutate(nino = nino34anom > 0) %>%
group_by(nino, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~nino)
monthly_fishing_pacific %>%
left_join(nino, by = c("year", "month")) %>%
drop_na(nino34anom) %>%
mutate(nino = nino34anom > 0) %>%
group_by(nino, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~nino) +
coord_equal()
monthly_fishing_pacific %>%
left_join(nino, by = c("year", "month")) %>%
drop_na(nino34anom) %>%
mutate(nino = nino34anom > 0) %>%
group_by(nino, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~nino, ncol = 1) +
coord_equal()
monthly_fishing_pacific %>%
left_join(nino, by = c("year", "month")) %>%
drop_na(nino34anom) %>%
mutate(nino = nino34anom > 0) %>%
group_by(nino, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~nino, ncol = 1) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20), trans = "log10")
monthly_fishing_pacific <- get_table(project = "ucsb-gfw",
dataset = "jc_bycatch",
table = "monthly_fishing_pacific")
monthly_fishing_pacific %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~nino, ncol = 1) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20), trans = "log10")
monthly_fishing_pacific %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~best_flag, ncol = 1) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20), trans = "log10")
monthly_fishing_pacific %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours, na.rm = T)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~best_flag) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20), trans = "log10")
length(unique(monthly_fishing_pacific$best_flag))
countries <- c("CHN", "ESP", "JPN", "KOR", "PRT", "TWN", "USA", "VUT")
monthly_fishing_pacific %>%
filter(best_flag %in% countries) %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours, na.rm = T)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~best_flag) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20), trans = "log10")
monthly_fishing_pacific %>%
filter(best_flag %in% countries) %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours, na.rm = T)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~best_flag) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20))
monthly_fishing_pacific %>%
filter(best_flag %in% countries) %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours, na.rm = T)) %>%
ungroup() %>%
ggplot(aes(x = lon, y = lat, fill = hours)) +
geom_raster() +
facet_wrap(~best_flag) +
coord_equal() +
scale_fill_gradientn(colours = colorRamps::matlab.like(20), trans = "log10") +
ggtheme_plot()
nmf_data <- monthly_fishing_pacific %>%
filter(best_flag %in% countries) %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours, na.rm = T)) %>%
ungroup() %>%
mutate(lonlat = paste(lon, lat, sep = "-")) %>%
select(best_flag, lonlat, hours) %>%
spread(lonlat, hours)
select <- dplyr::select
nmf_data <- monthly_fishing_pacific %>%
filter(best_flag %in% countries) %>%
drop_na(best_flag) %>%
group_by(best_flag, lon, lat) %>%
summarize(hours = sum(hours, na.rm = T)) %>%
ungroup() %>%
mutate(lonlat = paste(lon, lat, sep = "-")) %>%
select(best_flag, lonlat, hours) %>%
spread(lonlat, hours)
dim(nmf_data)
install.packages('NMF')
library(NMF)
install.packages('rngtools')
install.packages("rngtools")
